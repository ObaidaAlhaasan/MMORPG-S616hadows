{"version":3,"sources":["../../src/auth/auth.js"],"names":["passport","use","localStrategy","Strategy","usernameField","passwordField","passReqToCallback","request","email","password","done","username","body","UserModel","create","user","findOne","Error","isValidPassword","valid","jwtStrategy","secretOrKey","process","env","JWT_SECRET","jwtFromRequest","token","cookies","jwt"],"mappings":";;;;;;;;AAAA;;AACA;;AACA;;AAEA;;AAEA;AACAA,qBAASC,GAAT,CAAa,QAAb,EAAuB,IAAIC,0BAAcC,QAAlB,CAA2B;AAChDC,EAAAA,aAAa,EAAE,OADiC;AAEhDC,EAAAA,aAAa,EAAE,UAFiC;AAGhDC,EAAAA,iBAAiB,EAAE;AAH6B,CAA3B;AAAA;AAAA;AAAA;AAAA;AAAA,+BAIpB,iBAAOC,OAAP,EAAgBC,KAAhB,EAAuBC,QAAvB,EAAiCC,IAAjC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAESC,YAAAA,QAFT,GAEsBJ,OAAO,CAACK,IAF9B,CAESD,QAFT;AAAA;AAAA,mBAGoBE,sBAAUC,MAAV,CAAiB;AAAEN,cAAAA,KAAK,EAALA,KAAF;AAASC,cAAAA,QAAQ,EAARA,QAAT;AAAmBE,cAAAA,QAAQ,EAARA;AAAnB,aAAjB,CAHpB;;AAAA;AAGOI,YAAAA,IAHP;AAAA,6CAIQL,IAAI,CAAC,IAAD,EAAOK,IAAP,CAJZ;;AAAA;AAAA;AAAA;AAAA,6CAMQL,IAAI,aANZ;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAJoB;;AAAA;AAAA;AAAA;AAAA,IAAvB,E,CAcA;;;AACAV,qBAASC,GAAT,CAAa,OAAb,EAAsB,IAAIC,0BAAcC,QAAlB,CAA2B;AAC/CC,EAAAA,aAAa,EAAE,OADgC;AAE/CC,EAAAA,aAAa,EAAE;AAFgC,CAA3B;AAAA;AAAA;AAAA;AAAA;AAAA,+BAGnB,kBAAOG,KAAP,EAAcC,QAAd,EAAwBC,IAAxB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBAEoBG,sBAAUG,OAAV,CAAkB;AAAER,cAAAA,KAAK,EAALA;AAAF,aAAlB,CAFpB;;AAAA;AAEOO,YAAAA,IAFP;;AAAA,gBAGMA,IAHN;AAAA;AAAA;AAAA;;AAAA,8CAIUL,IAAI,CAAC,IAAIO,KAAJ,CAAU,gBAAV,CAAD,EAA8B,KAA9B,CAJd;;AAAA;AAAA;AAAA,mBAMqBF,IAAI,CAACG,eAAL,CAAqBT,QAArB,CANrB;;AAAA;AAMOU,YAAAA,KANP;;AAAA,gBAOMA,KAPN;AAAA;AAAA;AAAA;;AAAA,8CAQUT,IAAI,CAAC,IAAIO,KAAJ,CAAU,kBAAV,CAAD,EAAgC,KAAhC,CARd;;AAAA;AAAA,8CAUQP,IAAI,CAAC,IAAD,EAAOK,IAAP,CAVZ;;AAAA;AAAA;AAAA;AAAA,8CAYQL,IAAI,cAZZ;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAHmB;;AAAA;AAAA;AAAA;AAAA,IAAtB,E,CAmBA;;;AACAV,qBAASC,GAAT,CAAa,IAAImB,wBAAYjB,QAAhB,CAAyB;AACpCkB,EAAAA,WAAW,EAAEC,OAAO,CAACC,GAAR,CAAYC,UADW;AAEpCC,EAAAA,cAAc,EAAE,wBAAClB,OAAD,EAAa;AAC3B,QAAImB,KAAK,GAAG,IAAZ;AACA,QAAInB,OAAO,IAAIA,OAAO,CAACoB,OAAvB,EAAgCD,KAAK,GAAGnB,OAAO,CAACoB,OAAR,CAAgBC,GAAxB;AAChC,WAAOF,KAAP;AACD;AANmC,CAAzB;AAAA;AAAA;AAAA;AAAA;AAAA,+BAOV,kBAAOA,KAAP,EAAchB,IAAd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,8CAEQA,IAAI,CAAC,IAAD,EAAOgB,KAAK,CAACX,IAAb,CAFZ;;AAAA;AAAA;AAAA;AAAA,8CAIQL,IAAI,cAJZ;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAPU;;AAAA;AAAA;AAAA;AAAA,IAAb","sourcesContent":["import passport from 'passport';\nimport localStrategy from 'passport-local';\nimport jwtStrategy from 'passport-jwt';\n\nimport UserModel from '../models/UserModel';\n\n// handle user registration\npassport.use('signup', new localStrategy.Strategy({\n  usernameField: 'email',\n  passwordField: 'password',\n  passReqToCallback: true,\n}, async (request, email, password, done) => {\n  try {\n    const { username } = request.body;\n    const user = await UserModel.create({ email, password, username });\n    return done(null, user);\n  } catch (error) {\n    return done(error);\n  }\n}));\n\n// handle user login\npassport.use('login', new localStrategy.Strategy({\n  usernameField: 'email',\n  passwordField: 'password',\n}, async (email, password, done) => {\n  try {\n    const user = await UserModel.findOne({ email });\n    if (!user) {\n      return done(new Error('user not found'), false);\n    }\n    const valid = await user.isValidPassword(password);\n    if (!valid) {\n      return done(new Error('invalid password'), false);\n    }\n    return done(null, user);\n  } catch (error) {\n    return done(error);\n  }\n}));\n\n// verify jwt token\npassport.use(new jwtStrategy.Strategy({\n  secretOrKey: process.env.JWT_SECRET,\n  jwtFromRequest: (request) => {\n    let token = null;\n    if (request && request.cookies) token = request.cookies.jwt;\n    return token;\n  },\n}, async (token, done) => {\n  try {\n    return done(null, token.user);\n  } catch (error) {\n    return done(error);\n  }\n}));\n"],"file":"auth.js"}